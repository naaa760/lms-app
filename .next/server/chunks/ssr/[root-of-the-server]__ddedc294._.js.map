{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///home/neha/lms-app/lib/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\nimport { auth } from \"@clerk/nextjs/server\";\n\nexport const createSupabaseClient = () => {\n  return createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      async accessToken() {\n        return (await auth()).getToken();\n      },\n    }\n  );\n};\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,MAAM,uBAAuB;IAClC,OAAO,CAAA,GAAA,uLAAA,CAAA,eAAY,AAAD,sUAGhB;QACE,MAAM;YACJ,OAAO,CAAC,MAAM,CAAA,GAAA,mLAAA,CAAA,OAAI,AAAD,GAAG,EAAE,QAAQ;QAChC;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///home/neha/lms-app/lib/actions/companion.actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@clerk/nextjs/server\";\nimport { createSupabaseClient } from \"@/lib/supabase\";\nimport { revalidatePath } from \"next/cache\";\n\nexport const createCompanion = async (formData: CreateCompanion) => {\n  const { userId: author } = await auth();\n  const supabase = createSupabaseClient();\n\n  const { data, error } = await supabase\n    .from(\"companions\")\n    .insert({ ...formData, author })\n    .select();\n\n  if (error || !data)\n    throw new Error(error?.message || \"Failed to create a companion\");\n\n  return data[0];\n};\n\nexport const getAllCompanions = async ({\n  limit = 10,\n  page = 1,\n  subject,\n  topic,\n}: GetAllCompanions) => {\n  const supabase = createSupabaseClient();\n\n  let query = supabase.from(\"companions\").select();\n\n  if (subject && topic) {\n    query = query\n      .ilike(\"subject\", `%${subject}%`)\n      .or(`topic.ilike.%${topic}%,name.ilike.%${topic}%`);\n  } else if (subject) {\n    query = query.ilike(\"subject\", `%${subject}%`);\n  } else if (topic) {\n    query = query.or(`topic.ilike.%${topic}%,name.ilike.%${topic}%`);\n  }\n\n  query = query.range((page - 1) * limit, page * limit - 1);\n\n  const { data: companions, error } = await query;\n\n  if (error) throw new Error(error.message);\n\n  return companions;\n};\n\nexport const getCompanion = async (id: string) => {\n  const supabase = createSupabaseClient();\n\n  const { data, error } = await supabase\n    .from(\"companions\")\n    .select()\n    .eq(\"id\", id);\n\n  if (error) return console.log(error);\n\n  return data[0];\n};\n\nexport const addToSessionHistory = async (companionId: string) => {\n  const { userId } = await auth();\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase.from(\"session_history\").insert({\n    companion_id: companionId,\n    user_id: userId,\n  });\n\n  if (error) throw new Error(error.message);\n\n  return data;\n};\n\nexport const getRecentSessions = async (limit = 10) => {\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"session_history\")\n    .select(`companions:companion_id (*)`)\n    .order(\"created_at\", { ascending: false })\n    .limit(limit);\n\n  if (error) throw new Error(error.message);\n\n  return data.map(({ companions }) => companions);\n};\n\nexport const getUserSessions = async (userId: string, limit = 10) => {\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"session_history\")\n    .select(`companions:companion_id (*)`)\n    .eq(\"user_id\", userId)\n    .order(\"created_at\", { ascending: false })\n    .limit(limit);\n\n  if (error) throw new Error(error.message);\n\n  return data.map(({ companions }) => companions);\n};\n\nexport const getUserCompanions = async (userId: string) => {\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"companions\")\n    .select()\n    .eq(\"author\", userId);\n\n  if (error) throw new Error(error.message);\n\n  return data;\n};\n\nexport const newCompanionPermissions = async () => {\n  const { userId, has } = await auth();\n  const supabase = createSupabaseClient();\n\n  let limit = 0;\n\n  if (has({ plan: \"pro\" })) {\n    return true;\n  } else if (has({ feature: \"3_companion_limit\" })) {\n    limit = 3;\n  } else if (has({ feature: \"10_companion_limit\" })) {\n    limit = 10;\n  }\n\n  const { data, error } = await supabase\n    .from(\"companions\")\n    .select(\"id\", { count: \"exact\" })\n    .eq(\"author\", userId);\n\n  if (error) throw new Error(error.message);\n\n  const companionCount = data?.length;\n\n  if (companionCount >= limit) {\n    return false;\n  } else {\n    return true;\n  }\n};\n\n// Bookmarks\nexport const addBookmark = async (companionId: string, path: string) => {\n  const { userId } = await auth();\n  if (!userId) return;\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase.from(\"bookmarks\").insert({\n    companion_id: companionId,\n    user_id: userId,\n  });\n  if (error) {\n    throw new Error(error.message);\n  }\n  // Revalidate the path to force a re-render of the page\n\n  revalidatePath(path);\n  return data;\n};\n\nexport const removeBookmark = async (companionId: string, path: string) => {\n  const { userId } = await auth();\n  if (!userId) return;\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"bookmarks\")\n    .delete()\n    .eq(\"companion_id\", companionId)\n    .eq(\"user_id\", userId);\n  if (error) {\n    throw new Error(error.message);\n  }\n  revalidatePath(path);\n  return data;\n};\n\n// It's almost the same as getUserCompanions, but it's for the bookmarked companions\nexport const getBookmarkedCompanions = async (userId: string) => {\n  const supabase = createSupabaseClient();\n  const { data, error } = await supabase\n    .from(\"bookmarks\")\n    .select(`companions:companion_id (*)`) // Notice the (*) to get all the companion data\n    .eq(\"user_id\", userId);\n  if (error) {\n    throw new Error(error.message);\n  }\n  // We don't need the bookmarks data, so we return only the companions\n  return data.map(({ companions }) => companions);\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///home/neha/lms-app/components/CompanionForm.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CompanionForm.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CompanionForm.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgS,GAC7T,8DACA","debugId":null}},
    {"offset": {"line": 281, "column": 0}, "map": {"version":3,"sources":["file:///home/neha/lms-app/components/CompanionForm.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CompanionForm.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CompanionForm.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA4Q,GACzS,0CACA","debugId":null}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///home/neha/lms-app/app/companions/new/page.tsx"],"sourcesContent":["import CompanionForm from \"@/components/CompanionForm\";\nimport { auth } from \"@clerk/nextjs/server\";\nimport { redirect } from \"next/navigation\";\nimport { newCompanionPermissions } from \"@/lib/actions/companion.actions\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\n\nconst NewCompanion = async () => {\n  const { userId } = await auth();\n  if (!userId) redirect(\"/sign-in\");\n\n  const canCreateCompanion = await newCompanionPermissions();\n\n  return (\n    <main className=\"min-lg:w-1/3 min-md:w-2/3 items-center justify-center\">\n      {canCreateCompanion ? (\n        <article className=\"w-full gap-4 flex flex-col\">\n          <h1>Companion Builder</h1>\n\n          <CompanionForm />\n        </article>\n      ) : (\n        <article className=\"companion-limit\">\n          <Image\n            src=\"/images/limit.svg\"\n            alt=\"Companion limit reached\"\n            width={360}\n            height={230}\n          />\n          <div className=\"cta-badge\">Upgrade your plan</div>\n          <h1>You’ve Reached Your Limit</h1>\n          <p>\n            You’ve reached your companion limit. Upgrade to create more\n            companions and premium features.\n          </p>\n          <Link\n            href=\"/subscription\"\n            className=\"btn-primary w-full justify-center\"\n          >\n            Upgrade My Plan\n          </Link>\n        </article>\n      )}\n    </main>\n  );\n};\n\nexport default NewCompanion;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;AAEA,MAAM,eAAe;IACnB,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA,GAAA,mLAAA,CAAA,OAAI,AAAD;IAC5B,IAAI,CAAC,QAAQ,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE;IAEtB,MAAM,qBAAqB,MAAM,CAAA,GAAA,sIAAA,CAAA,0BAAuB,AAAD;IAEvD,qBACE,8OAAC;QAAK,WAAU;kBACb,mCACC,8OAAC;YAAQ,WAAU;;8BACjB,8OAAC;8BAAG;;;;;;8BAEJ,8OAAC,4HAAA,CAAA,UAAa;;;;;;;;;;iCAGhB,8OAAC;YAAQ,WAAU;;8BACjB,8OAAC,6HAAA,CAAA,UAAK;oBACJ,KAAI;oBACJ,KAAI;oBACJ,OAAO;oBACP,QAAQ;;;;;;8BAEV,8OAAC;oBAAI,WAAU;8BAAY;;;;;;8BAC3B,8OAAC;8BAAG;;;;;;8BACJ,8OAAC;8BAAE;;;;;;8BAIH,8OAAC,4JAAA,CAAA,UAAI;oBACH,MAAK;oBACL,WAAU;8BACX;;;;;;;;;;;;;;;;;AAOX;uCAEe","debugId":null}}]
}